# Neural Autoencoder Detector — Discovery Notes

- **Training path**: `experiments/run_experiment_multiseed.py:307-314` instantiates `NeuralDetector` (`src/detection/neural_detector.py:89`) and calls `fit(train_features, epochs=50, batch_size=64)`. `train_features` currently comes from `StratifiedDataSplitter.split_features` (`src/utils/data_splitter.py:180-257`), so the autoencoder is trained on a stratified mix of clean and backdoor windows rather than clean-only data. Inside `NeuralDetector.fit` the StandardScaler is fit on the provided features and a random 80/20 split drives reconstruction training and validation loss (`src/detection/neural_detector.py:128-188`).
- **Anomaly score**: `NeuralDetector.predict` applies the saved scaler, runs the autoencoder forward pass, and returns mean-squared reconstruction error per sample as the anomaly score (`src/detection/neural_detector.py:202-219`).
- **Threshold selection**: During multi-seed runs the validation scores are passed to `find_optimal_threshold(..., metric='f1')` (`src/utils/metrics.py:59-131`), which grid-searches over score quantiles to maximize F1, generally yielding thresholds near zero that produce very high false-alarm rates.
- **Evaluation + logging**: Test-set predictions and scores feed into `DetectionMetrics.compute_metrics` (`src/utils/metrics.py:19-98`), capturing accuracy/precision/recall/F1/FAR plus confusion counts and optional AUC. Aggregated per-trial metrics (including the chosen threshold) are serialized in `experiments/run_experiment_multiseed.py:429-520` to `experiments/results/multiseed_results_<timestamp>.json`, which reports mean ± std across seeds (`experiments/results/*multiseed*.json`).
- **Current bottleneck symptoms**: Aggregated neural autoencoder stats show `false_alarm_rate_mean ≈ 0.98` with `recall_mean ≈ 0.67` (`experiments/results/multiseed_results_20251101_172000.json`), consistent with the F1-optimized threshold on a label-balanced training/validation split that treats most clean windows as anomalies. Clean-only fitting, per-split preprocessing, and threshold strategies constrained by FAR are not yet implemented.
